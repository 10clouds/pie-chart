/*! pie-chart - v1.0.0 - 2013-10-29
* https://github.com/n3-charts/pie-chart
* Copyright (c) 2013 n3-charts  Licensed ,  */
angular.module("n3-pie-chart",["n3-pie-utils"]).directive("pieChart",["$utils","$window",function(a,b){var c=function(c,d){var e=a.getDefaultMargins();c.updateDimensions=function(a){a.width=d[0].parentElement.offsetWidth||900,a.height=d[0].parentElement.offsetHeight||500},c.update=function(){c.updateDimensions(e),c.redraw(e)},c.redraw=function(b){var e=c.data,f=c.options;if(a.clean(d[0]),e&&f){var g=a.bootstrap(d[0],b);a.draw(g,e,b)}},b.onresize=function(){c.update()},c.$watch("data",c.update),c.$watch("options",c.update,!0)};return{replace:!0,restrict:"E",scope:{data:"=",options:"="},template:"<div></div>",link:c}}]),angular.module("n3-pie-utils",[]).factory("$utils",[function(){return{getDefaultMargins:function(){return{top:20,right:50,bottom:30,left:50}},clean:function(a){d3.select(a).select("svg").remove()},bootstrap:function(a,b){d3.select(a).classed("chart",!0);var c=b.width,d=b.height,e=d3.select(a).append("svg").attr("width",c).attr("height",d).append("g").attr("transform","translate("+.5*b.width+","+.5*b.height+")");return e},getRadius:function(a){var b=a;return.5*Math.min(b.width-b.left-b.right,b.height-b.top-b.bottom)},createContent:function(a){a.append("g").attr("class","content")},draw:function(a,b,c){var d=this.getRadius(c),e=d3.svg.arc().outerRadius(d).innerRadius(0),f=d3.layout.pie().sort(null).value(function(a){return a.value}),g=a.selectAll(".arc").data(f(b)).enter().append("g").attr("class","arc"),h=this;g.append("path").attr("d",e).style("stroke",function(a){return a.data.color}).style("fill",function(a){return a.data.color}).style("fill-opacity",.2).on("mouseover",function(b){var e=.5*Math.PI-(.5*(b.endAngle-b.startAngle)+b.startAngle);h.moveTooltip(d+10,e,a,c)}),g.append("text").attr("transform",function(a){return"translate("+e.centroid(a)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(a){return a.value+"%"})},moveTooltip:function(a,b,c){var d=100,e=20,f={x:a*Math.cos(b),y:-a*Math.sin(b)},g={x:0,y:0,l:"top_left"},h={x:+d,y:0,l:"top_right"},i={x:0,y:+e,l:"bottom_left"},j={x:+d,y:+e,l:"bottom_right"},k=this.getCloser(f,[g,h,i,j]);c.select("#tooltip").attr({x:f.x-k.x,y:f.y-k.y})},getCloser:function(a,b){for(var c,d=Number.POSITIVE_INFINITY,e=0;e<b.length;e++){var f=this.dist({x:0,y:0},{x:a.x+b[e].x,y:a.y+b[e].y});d>f&&(d=f,c=b[e])}return c},dist:function(a,b){return Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))},_getCoordinates:function(a){var b=Math.PI,c=100,d=20;return a=2*b%a,a>=7*b/4&&b/4>a?{x:c/2,y:-(c*Math.tan(a))/2}:a>=b/4&&3*b/4>a?{y:-d/2,x:-d/(2*Math.tan(a))}:a>=3*b/4&&5*b/4>a?{x:-c/2,y:c*Math.tan(a)/2}:a>=5*b/4&&0>a||a>=0&&7*b/4>a?{y:d/2,x:d/(2*Math.tan(a))}:void 0},addTooltip:function(a){a.append("g").append("rect").attr({id:"tooltip",width:100,height:20}).style({fill:"steelblue"})}}}]);