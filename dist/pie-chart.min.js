/*! pie-chart - v1.0.0 - 2013-11-01
* https://github.com/n3-charts/pie-chart
* Copyright (c) 2013 n3-charts  Licensed ,  */
angular.module("n3-pie-chart",["n3-pie-utils"]).directive("pieChart",["$utils","$window",function(a,b){var c=function(c,d){var e=a.getDefaultMargins(),f=function(a){a.width=d[0].parentElement.offsetWidth||900,a.height=d[0].parentElement.offsetHeight||500},g=function(){a.clean(d[0]),f(e),h(e)},h=function(b){var e=c.data,f=c.options;if(e&&f){e=e.concat();var g=a.bootstrap(d[0],b);a.draw(g,e,b,f).addLegend(g,e,b,f)}};b.onresize=function(){g()},c.$watch("data",g,!0),c.$watch("options",g,!0)};return{replace:!0,restrict:"E",scope:{data:"=",options:"="},template:"<div></div>",link:c}}]),angular.module("n3-pie-utils",[]).factory("$utils",[function(){return{draw:function(a,b,c,d){var e=this.getRadius(c),f=d3.svg.arc().outerRadius(e).innerRadius(e-d.thickness),g=d3.layout.pie().value(function(a){return a.value}),h=a.selectAll(".arc").data(g(b.concat())).enter().append("g").attr({"class":"arc",id:function(a,b){return"arc_"+b}});return h.append("path").attr({d:f}).style({fill:function(a){return a.data.color},"fill-opacity":.8}),this},addLegend:function(a,b,c,d){var e=Math.floor(b.length/2),f=a.selectAll(".legend-item").data(b.sort(function(a,b){return b.value-a.value})).enter().append("g").classed("legend-item",!0).style({fill:function(a){return a.color},"fill-opacity":.8}).attr({transform:function(a,b){return"translate(0, "+15*(b-e)+")"}}).on("mouseover",this.onMouseOver(a)).on("mouseout",this.onMouseOut(a)),g=this,h=this.getRadius(c),i=c.width-2*(h-d.thickness);f.append("text").text(function(a){return 100>i?"":150>i?a.label:g.getLegendLabel(a.label,a.value,20)}).attr({"text-anchor":"middle",x:"0px",y:"15px"}).style({"font-family":"monospace"})},onMouseOver:function(a){return function(b,c){var d=function(a){return a.transition().duration(50).style({opacity:function(a,b){return b===c?"1":"0.4"}})};d(a.selectAll(".legend-item")),d(a.selectAll(".arc"))}},onMouseOut:function(a){return function(){var b=function(a){return a.transition().duration(50).style({opacity:1})};b(a.selectAll(".legend-item")),b(a.selectAll(".arc"))}},getLegendLabel:function(a,b,c){for(var d=[],e=0;c>e;e++)d.push(".");return a+=" ",b=" "+b,a.split("").forEach(function(a,b){d[b]=a}),b.split("").forEach(function(a,e){d[c-b.length+e]=a}),d.join("")},getDefaultMargins:function(){return{top:20,right:50,bottom:30,left:50}},clean:function(a){d3.select(a).select("svg").remove()},bootstrap:function(a,b){d3.select(a).classed("chart",!0);var c=b.width,d=b.height,e=d3.select(a).append("svg").attr("width",c).attr("height",d).append("g").attr("transform","translate("+.5*b.width+","+.5*b.height+")");return e},getRadius:function(a){var b=a;return.5*Math.min(b.width-b.left-b.right,b.height-b.top-b.bottom)},createContent:function(a){a.append("g").attr("class","content")},sanitizeOptions:function(a){return void 0===a.thickness&&(a.thickness=20),a.thickness=parseInt(a.thickness),a}}}]);